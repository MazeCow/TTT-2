<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Management</title>
    <style></style>
  </head>
  <body>
    <p>index.html</p>
    <div id="user-container"></div>
  </body>
  <script>
    const userContainer = document.getElementById("user-container");
    let productData;
    let purchaseData;

    /* Fetch product data. */
    fetch("http://localhost:3000/products")
      .then((res) => res.json())
      .then((data) => {
        productData = data;
      });

    /* Fetch user data, find totals, and display data to the webpage. */
    fetch("http://localhost:3000/users")
      .then((res) => res.json())
      .then((userData) => {
        let grandTotal = 0;
        const newUserData = userData.map((user) => {
          const newProducts = user.products.map((item) => {
            const price = productData[item.id].price;
            const quantity = item.quantity;
            const total = price * quantity;
            grandTotal += total;
            return {
              id: item.id,
              name: productData[item.id].name,
              price: price,
              quantity: quantity,
              total: total,
            };
          });
          return {
            name: user.name,
            age: user.age,
            cart: newProducts,
          };
        });
        purchaseData = newUserData;
      });
  </script>
</html>
